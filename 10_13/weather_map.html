<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>도시별 날씨 * 지도(Open-Meteo + Leaflet)</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
    <style>
        #map {width: 100%; height: 350px; margin-top: 10px;}
        body {font-family: sans-serif; line-height: 1.6;}
        select {padding: 5px; margin-top: 10px;}
    </style>
</head>
<body>
    <h2>도시별 현재 날씨</h2>
    
    <select id="citySelect">
        <option value="1">충주시</option>
        <option value="2">서울</option>
        <option value="3">부산</option>
        <option value="4">대전</option>
    </select>
    <button id="load">날씨 불러오기</button>
    
    <div id="weather" style="margin-top: 10px;"></div>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <script>
        // 도시별 위도와 경도 정보
        const cities = {
            1: { name: "충주시", lat: 36.9723, lon: 127.9284 },
            2: { name: "서울", lat: 37.5665, lon: 126.9780 },
            3: { name: "부산", lat: 35.1796, lon: 129.0756 },
            4: { name: "대전", lat: 36.3504, lon: 127.3845 }
        };

        const map = L.map('map').setView([36.9723, 127.9284], 11);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);

        document.getElementById("load").onclick = async () => {
            const selectedCity = document.getElementById("citySelect").value;
            const city = cities[selectedCity];
            const { lat, lon, name } = city;

            const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`;

            try {
                const r = await fetch(url);
                const data = await r.json();
                const w = data.current_weather;
                const inf = 
                    `<b>${name}</b><br>` +
                    `<b>온도</b>: ${w.temperature}°C<br>` +
                    `<b>풍속</b>: ${w.windspeed}m/s<br>` +
                    `관측시간(UTC): ${w.time}`;

                document.getElementById("weather").innerHTML = inf;

                // 지도에 마커 추가
                map.setView([lat, lon], 11); // 지도 위치 변경
                L.marker([lat, lon])
                    .addTo(map)
                    .bindPopup(inf)
                    .openPopup();
            } catch (e) {
                document.getElementById("weather").textContent = "에러 발생: " + e.message;
            }
        };
    </script>
</body>
</html>
